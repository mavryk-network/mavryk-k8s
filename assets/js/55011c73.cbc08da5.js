"use strict";(self.webpackChunkdocusaurus=self.webpackChunkdocusaurus||[]).push([[950],{3905:function(e,n,t){t.d(n,{Zo:function(){return d},kt:function(){return m}});var a=t(7294);function i(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function o(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function r(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?o(Object(t),!0).forEach((function(n){i(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):o(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function l(e,n){if(null==e)return{};var t,a,i=function(e,n){if(null==e)return{};var t,a,i={},o=Object.keys(e);for(a=0;a<o.length;a++)t=o[a],n.indexOf(t)>=0||(i[t]=e[t]);return i}(e,n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)t=o[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(i[t]=e[t])}return i}var s=a.createContext({}),c=function(e){var n=a.useContext(s),t=n;return e&&(t="function"==typeof e?e(n):r(r({},n),e)),t},d=function(e){var n=c(e.components);return a.createElement(s.Provider,{value:n},e.children)},u={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},p=a.forwardRef((function(e,n){var t=e.components,i=e.mdxType,o=e.originalType,s=e.parentName,d=l(e,["components","mdxType","originalType","parentName"]),p=c(t),m=i,f=p["".concat(s,".").concat(m)]||p[m]||u[m]||o;return t?a.createElement(f,r(r({ref:n},d),{},{components:t})):a.createElement(f,r({ref:n},d))}));function m(e,n){var t=arguments,i=n&&n.mdxType;if("string"==typeof e||i){var o=t.length,r=new Array(o);r[0]=p;var l={};for(var s in n)hasOwnProperty.call(n,s)&&(l[s]=n[s]);l.originalType=e,l.mdxType="string"==typeof e?e:i,r[1]=l;for(var c=2;c<o;c++)r[c]=t[c];return a.createElement.apply(null,r)}return a.createElement.apply(null,t)}p.displayName="MDXCreateElement"},6291:function(e,n,t){t.r(n),t.d(n,{assets:function(){return d},contentTitle:function(){return s},default:function(){return m},frontMatter:function(){return l},metadata:function(){return c},toc:function(){return u}});var a=t(7462),i=t(3366),o=(t(7294),t(3905)),r=["components"],l={},s="Nodes",c={unversionedId:"Mavryk-Nodes",id:"Mavryk-Nodes",title:"Nodes",description:"Use nodes to configure the Mavryk nodes running in your chart.",source:"@site/01-Mavryk-Nodes.md",sourceDirName:".",slug:"/Mavryk-Nodes",permalink:"/Mavryk-Nodes",tags:[],version:"current",sidebarPosition:1,frontMatter:{},sidebar:"mavrykK8sSidebar",previous:{title:"Accounts",permalink:"/Mavryk-Accounts"},next:{title:"Signers",permalink:"/Mavryk-Signers"}},d={},u=[],p={toc:u};function m(e){var n=e.components,t=(0,i.Z)(e,r);return(0,o.kt)("wrapper",(0,a.Z)({},p,t,{components:n,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"nodes"},"Nodes"),(0,o.kt)("p",null,"Use ",(0,o.kt)("inlineCode",{parentName:"p"},"nodes")," to configure the Mavryk nodes running in your chart."),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"nodes")," is a dictionary where each key/value pair defines a statefulset and a\nnumber of instances thereof. The name (key) defines the name of the\nstatefulset and will be the base of the pod names. The instances are defined\nas a list because their names are simply -N appended to the statefulsetname.\nSaid names are typically kebab case."),(0,o.kt)("p",null,"Params at the statefulset level:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"config"),': The "config" property should mimic the structure of a node\'s\nconfig.json. Run ',(0,o.kt)("inlineCode",{parentName:"li"},"mavkit-node config --help")," for more info.\nIf present at the statefulset level, it overrides it in\n",(0,o.kt)("inlineCode",{parentName:"li"},"node_globals"),"."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"env"),': A dictionary of containers mapped to a dictionary of env\nvars.  The container name "all" will apply the env vars to\nall containers.  The most specific wins.  Find the names of\nthe containers by examining an installed environment, or by\nlooking at charts/mavryk/templates/nodes.yaml.  Please note\nthat we truncate the protocol from the container name for\nbakers and accusers, so "baker-011-pthangz2" is configured\nusing just "baker".'),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"storage_size"),": The size of the PV."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"resources"),": Resources specifications for the node.\nOptionally set resources and limits for mavkit node\nSee: ",(0,o.kt)("a",{parentName:"li",href:"https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/"},"https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"images"),': Optional specification of images to use for the mavryk node and\nbaker. Options are "mavkit" with a mavrykdynamics/mavryk image.\nIf no images are provided, the containers will default to the images\ndefined in the "images" field up above.'),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"runs"),": A list of containers to run.\nOptions being ",(0,o.kt)("inlineCode",{parentName:"li"},"mavkit_node"),", ",(0,o.kt)("inlineCode",{parentName:"li"},"accuser"),", ",(0,o.kt)("inlineCode",{parentName:"li"},"baker"),", ",(0,o.kt)("inlineCode",{parentName:"li"},"logger")," and ",(0,o.kt)("inlineCode",{parentName:"li"},"vdf"),"."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"local_storage"),": Use local storage instead of a volume. The storage will be\nwiped when the node restarts for any reason. Useful when\nfaster IO is desired. Defaults to false."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"local_storage_pv_size"),": The size of the persistent volume to store ",(0,o.kt)("inlineCode",{parentName:"li"},"identity.json"),"\nand ",(0,o.kt)("inlineCode",{parentName:"li"},"peers.json")," when ",(0,o.kt)("inlineCode",{parentName:"li"},"local_storage")," is enabled. Some cloud\nproviders have minimum pv size requirements for which this\nvalue can be used. Default value is 1Gi."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"labels"),": ",(0,o.kt)("a",{parentName:"li",href:"https://kubernetes.io/docs/concepts/overview/working-with-objects/labels/"},"https://kubernetes.io/docs/concepts/overview/working-with-objects/labels/"),"\nNOTE: the labels ",(0,o.kt)("inlineCode",{parentName:"li"},"appType"),", ",(0,o.kt)("inlineCode",{parentName:"li"},"node_class"),", and ",(0,o.kt)("inlineCode",{parentName:"li"},"baking_node")," are set\nautomatically for you."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"node_selector"),": Specify a kubernetes node selector in ",(0,o.kt)("inlineCode",{parentName:"li"},"key: value")," format\nfor your mavryk nodes."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"tolerations"),": Specify kubernetes tolerations as a list for your mavryk nodes."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"readiness_probe"),": Attach a probe to the node. The probe checks whether\nthe most recent block is recent enough. If not, the\nservices will be unreachable. Defaults to True.\nTrue is good for RPC nodes, private nodes, and\nself-contained private chains.\nRecommended to set to False when bootstrapping a new\nchain with external bakers, such as a new test chain.\nOtherwise, the chain may become unreachable externally\nwhile waiting for other nodes to come online."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"instances"),": A list of nodes to fire up, each is a dictionary defining:",(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"bake_using_account"),": Account name that should be used for baking.\nDon't also set ",(0,o.kt)("inlineCode",{parentName:"li"},"bake_using_accounts"),"."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"bake_using_accounts"),": List of account names that should be used for baking.\nDon't also set ",(0,o.kt)("inlineCode",{parentName:"li"},"bake_using_account"),"."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"authorized_keys"),": List of account names that should be used as keys to\nauthenticate a baker to a signer.\nWhen a baker uses a remote signer that requires\nauthentication, the relevant key from this list\nwill be used to sign every signature request."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"config"),": Same as the outer statefulset level ",(0,o.kt)("inlineCode",{parentName:"li"},"config"),". It overrides the\nstatefulset level."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"is_bootstrap_node"),": Boolean for is this node a bootstrap peer."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"identity"),": An optional map containing a pre-generated Mavryk node\nidentity. This is useful for local storage nodes which would\nneed to generate an identity at every boot. The identity file\nwill be created at /var/mavryk/node/data/identity.json.\nRequired fields are ",(0,o.kt)("inlineCode",{parentName:"li"},"peer_id"),", ",(0,o.kt)("inlineCode",{parentName:"li"},"public_key"),", ",(0,o.kt)("inlineCode",{parentName:"li"},"secret_key"),",\nand ",(0,o.kt)("inlineCode",{parentName:"li"},"proof_of_work_timestamp"),".")))),(0,o.kt)("p",null,"Defaults are filled in for most of the above values.  You can also provide\nglobal defaults for all nodes via a ",(0,o.kt)("inlineCode",{parentName:"p"},"node_globals")," section which is also\na dictionary.  Currently, two keys are defined: ",(0,o.kt)("inlineCode",{parentName:"p"},"config")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"env"),".  These\noperate in the same way as the section in ",(0,o.kt)("inlineCode",{parentName:"p"},"nodes")," going by the same name."),(0,o.kt)("p",null,"Example config:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},'node_globals:\n  config:\n    shell:\n      history_mode: full\n  env:\n    baker:\n      MAVRYK_LOG: "* -> debug"\nnodes:\n  rolling-baking-node:\n    config:\n      shell:\n        history_mode: rolling\n    env:\n      all:\n        MAVRYK_CLIENT_UNSAFE_DISABLE_DISCLAIMER: "Y"\n      snapshot-downloader:\n        HTTP_PROXY: http://my-proxy.my-company.com:3128/\n    labels:\n      # Example labels you might use to specify certain attributes of your nodes.\n      peer_node: "true" # Forward P2P traffic to this node types instances\n      rpc_node: "true" # Forward RPC traffic to this node types instances\n    node_selector:\n      nodeSelectorKey: nodeSelectorValue\n    tolerations:\n      - key: "mavryk-node"\n        operator: "Equal"\n        value: "true"\n        effect: "NoSchedule"\n    storage_size: 15Gi\n    images: # (optional field)\n      mavkit: mavrykdynamics/mavryk:v...\n    local_storage: false\n    runs:\n      - mavkit_node\n      - baker\n    resources:\n      requests:\n        memory: 16192Mi\n      limits:\n        memory: 16192Mi\n    instances:\n      - bake_using_account: baker0\n        is_bootstrap_node: true\n        # Note the following config section overrides the above one even\n        # if we make them the same in this example.\n        config:\n          shell:\n            history_mode: rolling\n        identity:\n           peer_id: id...\n           public_key: ...\n           secret_key: ...\n           proof_of_work_stamp: ...\n  rolling-node:\n    labels:\n      # Example labels you might use to specify certain attributes of your nodes.\n      peer_node: "true"\n      rpc_node: "true"\n    images: # (optional field)\n      mavkit: mavrykdynamics/mavryk:v...\n    runs: ["mavkit_node"]\n    instances:\n      - {}\n      - {}\n')),(0,o.kt)("p",null,"The default configuration is:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},'node_globals:\n  config: {}\n  env: {}\nnodes: {}\n  # rolling-node:\n  #   storage_size: 100Gi\n  #   runs:\n  #     - mavkit_node\n  #   instances:\n  #     - is_bootstrap_node: false\n  #       config:\n  #         shell:\n  #           history_mode: rolling\n  #         metrics_addr: ["0.0.0.0:9932"]\n')))}m.isMDXComponent=!0}}]);